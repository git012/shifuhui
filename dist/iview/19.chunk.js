webpackJsonp([19],{1007:function(t,e,a){a(1169);var i=a(66)(a(1090),a(1275),null,null);i.options.__file="F:\\changhaochen\\世福惠\\src\\views\\system\\department.vue",i.esModule&&Object.keys(i.esModule).some(function(t){return"default"!==t&&"__esModule"!==t})&&console.error("named exports are not supported in *.vue files."),i.options.functional&&console.error("[vue-loader] department.vue: functional components are not supported with templates, they should use render functions."),t.exports=i.exports},1090:function(t,e,a){"use strict";(function(t){function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=a(155),s=i(r),n=a(231),o=i(n),d=a(116),l=i(d),c=a(100),u=i(c);e.default={name:"admin_department",data:function(){var t=this,e=function(t,e,a){e.length<1?a(new Error("请选择部门操作权限")):a()};return{columns:[{title:"ID",key:"id"},{title:"部门名称",key:"name"},{title:"操作",sortable:!0,key:"status",align:"center",render:function(e,a){return e("div",[e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){t.showEdit(a.index)}}},"修改"),e("Button",{props:{type:"error",size:"small"},on:{click:function(){t.delete(a.index)}}},"删除")])}}],saveType:"new",doType:"list",switching:!1,tableData:[],page:{dataCount:0,pageCount:0,pageSize:10,pageNumber:1,pageSizeOpts:[10,20,50,100]},rights:[],_rightsTreeData:[],rightsTreeData:[],treeDataReady:!1,currentData:{id:0,name:"",permission:[]},getLoading:!1,searchData:{keyword:"",searchDate:[],startDate:"",endDate:""},currentDataValidate:{name:[{required:!0,message:"请输入部门名称",trigger:"blur"}],permission:[{validator:e,trigger:"blur"}]}}},computed:{doName:function(){return"list"==this.doType?"部门管理":"edit"==this.doType?"编辑部门":"添加部门"}},methods:{getSelectRights:function(e){var a=[];t.each(e,function(t,e){e.id&&a.push(e.id)}),this.currentData.permission=a},doWhat:function(e){this.switching=!0,"add"==e&&(this.currentData={id:0,name:"",permission:[]},this.rightsTreeData=t.extend(!0,[],this._rightsTreeData)),"list"==e&&(this.currentData={id:0,name:"",permission:[]},this.init()),this.doType=e,this.switching=!1},saveEdit:function(){var e=this;this.$refs.currentData.validate(function(a){if(a){e.switching=!0;var i={ssid:u.default.get("ssid"),name:e.currentData.name,permission:(0,s.default)(e.currentData.permission)},r=o.default.apiRootPath+o.default.api.system.admin_department.add;"edit"==e.doType&&(i.id=e.currentData.id,r=o.default.apiRootPath+o.default.api.system.admin_department.edit),t.ajax({url:r,type:"POST",dataType:"json",data:i}).done(function(t){e.switching=!1,t?0==t.code?(e.$Message.success("添加成功"),e.doWhat("list"),e.init()):o.default.showError({vm:e,data:t,errorMsg:""}):o.default.showError({vm:e,data:t,errorMsg:"请求失败"})}).fail(function(t,a,i){e.switching=!1,e.doWhat("list"),o.default.showError({vm:e,data:"",errorMsg:"服务器通讯失败"})})}})},showEdit:function(e){var a=this;if(this.switching=!0,!this.treeDataReady)return void this.$Message.error("操作权限加载中，请稍后重试");this.treeDataReady=!1,this.currentData=t.extend(!0,{},this.tableData[e]),this.currentData.dataIndex=e,this.rightsTreeData=t.extend(!0,[],this._rightsTreeData),t.each(this.rightsTreeData,function(e,i){i.children&&t.each(i.children,function(t,e){for(var i=0;i<a.currentData.permission.length;i++)a.currentData.permission[i]==e.id&&(e.checked=!0)})}),this.treeDataReady=!0,this.doType="edit",this.switching=!1},changePage:function(t){this.page.pageNumber=t,this.search()},changePageSize:function(t){this.page.pageSize=t,this.page.pageCount=Math.ceil(this.page.dataCount/this.page.pageSize),this.search()},search:function(){this.searchData.searchDate.length&&(this.searchData.startDate=l.default.FormatDate(this.searchData.searchDate[0],"yyyy-MM-dd"),this.searchData.endDate=l.default.FormatDate(this.searchData.searchDate[1],"yyyy-MM-dd")),this.init()},setRights:function(){var e=this,a={ssid:u.default.get("ssid")};t.ajax({url:o.default.apiRootPath+o.default.api.system.admin_department.rights,type:"POST",dataType:"json",data:a}).done(function(a){if(a)if(0==a.code){e.rights=a.data;var i=e;t.each(e.rights,function(e,a){var r={title:a.module,expand:!1,children:[]};a.form&&t.each(a.form,function(t,e){r.children.push({title:e.name,id:e.id,checked:!1})}),i.rightsTreeData.push(r)}),e._rightsTreeData=t.extend(!0,[],i.rightsTreeData),e.treeDataReady=!0}else o.default.showError({vm:e,data:a,errorMsg:""});else o.default.showError({vm:e,data:a,errorMsg:"请求失败"})}).fail(function(t,a,i){o.default.showError({vm:e,errorMsg:"服务器通讯失败"})})},init:function(){var e=this;this.getLoading=!0;var a={ssid:u.default.get("ssid"),page:this.page.pageNumber,pageSize:this.page.pageSize};t.ajax({url:o.default.apiRootPath+o.default.api.system.admin_department.list,type:"POST",dataType:"json",data:a}).done(function(t){e.getLoading=!1,t?0==t.code?(e.page.dataCount=t.data.count,e.page.pageCount=Math.ceil(e.page.dataCount/e.page.pageSize),e.tableData=t.data.list):o.default.showError({vm:e,data:t,errorMsg:""}):o.default.showError({vm:e,data:t,errorMsg:"请求失败"})}).fail(function(t,a,i){e.getLoading=!1,o.default.showError({vm:e,errorMsg:"服务器通讯失败"})})},delete:function(e){var a=this;if(this.tableData[e].id){t.ajax({url:o.default.apiRootPath+o.default.api.system.admin_department.delete,type:"POST",dataType:"json",data:function(){return{ssid:u.default.get("ssid"),id:a.tableData[e].id,status:0}}()}).done(function(t){t?0==t.code?(a.$Message.success("删除成功!"),a.tableData.splice(e,1)):o.default.showError({vm:a,data:t,errorMsg:""}):o.default.showError({vm:a,data:t,errorMsg:"请求失败"})}).fail(function(t,e,i){o.default.showError({vm:a,errorMsg:"服务器通讯失败"})})}}},mounted:function(){this.setRights()},activated:function(){this.init()}}}).call(e,a(154))},1169:function(t,e){},1275:function(t,e,a){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Card",[a("p",{staticClass:"hasButtonP",attrs:{slot:"title"},slot:"title"},[a("Icon",{attrs:{type:"aperture"}}),t._v("\n            "+t._s(t.doName)+"\n            "),"list"!=t.doType?a("Button",{staticClass:"add-btu margin-left-10",attrs:{type:"warning",size:"small"},on:{click:function(e){t.doWhat("list")}}},[t._v("返回列表")]):t._e(),t._v(" "),"add"!=t.doType?a("Button",{staticClass:"add-btu",attrs:{type:"primary",size:"small"},on:{click:function(e){t.doWhat("add")}}},[t._v("添加部门")]):t._e()],1),t._v(" "),a("div",{staticClass:"doBox"},[t.switching?a("Spin",{attrs:{size:"large",fix:""}}):t._e(),t._v(" "),"list"!=t.doType?a("div",[a("Form",{ref:"currentData",attrs:{model:t.currentData,"label-width":100,"label-position":"right",rules:t.currentDataValidate}},[a("FormItem",{attrs:{label:"部门名称：",prop:"name"}},[a("Input",{staticStyle:{width:"200px"},attrs:{placeholder:"部门名称"},model:{value:t.currentData.name,callback:function(e){t.$set(t.currentData,"name",e)},expression:"currentData.name"}})],1),t._v(" "),a("FormItem",{attrs:{label:"操作权限：",prop:"permission"}},[t.treeDataReady?a("Tree",{ref:"rightsTree",staticClass:"rightsTree",attrs:{multiple:"",data:t.rightsTreeData,"show-checkbox":""},on:{"on-check-change":t.getSelectRights}}):t._e()],1),t._v(" "),a("FormItem",[a("Button",{attrs:{type:"primary",size:"small"},on:{click:t.saveEdit}},[t._v("保存")]),t._v(" "),a("Button",{attrs:{type:"text",size:"small"},on:{click:function(e){t.doWhat("list")}}},[t._v("取消")])],1)],1)],1):t._e(),t._v(" "),"list"==t.doType?a("div",{staticClass:"ordler-list"},[a("Table",{attrs:{border:"",columns:t.columns,loading:t.getLoading,data:t.tableData}}),t._v(" "),a("div",{staticClass:"page-box"},[t.page.pageCount>1?a("Page",{attrs:{total:t.page.dataCount,"show-total":"","page-size-opts":t.page.pageSizeOpts,"page-size":t.page.pageSize,"show-elevator":"",placement:"top","show-sizer":""},on:{"on-change":t.changePage,"on-page-size-change":t.changePageSize}}):t._e()],1)],1):t._e()],1)])],1)},staticRenderFns:[]},t.exports.render._withStripped=!0}});
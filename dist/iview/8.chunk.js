webpackJsonp([8],{1003:function(e,t,a){a(1161);var s=a(66)(a(1083),a(1283),null,null);s.options.__file="F:\\changhaochen\\GitHub\\shifuhui\\src\\views\\system\\assignments.vue",s.esModule&&Object.keys(s.esModule).some(function(e){return"default"!==e&&"__esModule"!==e})&&console.error("named exports are not supported in *.vue files."),s.options.functional&&console.error("[vue-loader] assignments.vue: functional components are not supported with templates, they should use render functions."),e.exports=s.exports},1012:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"noUpFileInput",data:function(){return{uploadApi:"",imgName:"",newFilePath:"",fileData:"",visible:!1,upLoading:!1,fileType:{image:/\.(gif|jpg|jpeg|png)$/,rar:/\.(rar|zip|7z)$/,txt:/\.(doc|docx|pdf|xsl|xslx|ppt|pptx|txt)$/,music:/\.(mp3|mp4|wma)$/}}},props:["fileInfro"],computed:{FilePath:function(){return this.newFilePath?this.newFilePath:this.fileInfro.url},file_infro:function(){return this.fileInfro?{uploadApi:this.fileInfro.uploadApi||this.uploadApi,url:this.fileInfro.url||"",fileObj:this.fileInfro.fileObj||"uploadFile",fileObjName:this.fileInfro.fileObjName||"图片",uploadMenu:this.fileInfro.uploadMenu||"选择图片",uploadType:this.fileInfro.uploadType||"sync",type:this.fileInfro.type||"image",maxSize:this.fileInfro.maxSize?this.fileInfro.maxSize:2048}:{url:"",fileObj:"uploadFile",fileObjName:"图片",uploadMenu:"选择图片",uploadType:"sync",type:"image",maxSize:2048}}},methods:{handleView:function(){this.visible=!0},selectFile:function(){this.$refs.fileObj.click()},handleFormatError:function(e){this.upLoading=!1,this.$Notice.warning({title:"文件类型错误",desc:"上传文件："+e.name+" 文件类型不正确"})},handleMaxSize:function(e){this.upLoading=!1,this.$Notice.warning({title:"文件过大",desc:"上传文件："+e.name+" 过大，请不要超过"+this.bytesToSize(1024*this.file_infro.maxSize)})},handleGetFile:function(){var e=this.$refs.fileObj.files[0];if(e){var t=e.name.substr(e.name.lastIndexOf(".")).toLowerCase();if(!this.fileType[this.file_infro.type].test(t))return this.handleFormatError(e),!1;if(Math.round(e.size/1024*100)/100>this.file_infro.maxSize)return this.handleMaxSize(e),!1;this.imgName=e.name,this.showPreview(e),this.fileInfro.file=e}},showPreview:function(e){var t=this;if(window.FileReader&&e){var a=new FileReader;a.onloadend=function(e){t.newFilePath=e.target.result},a.readAsDataURL(e)}},bytesToSize:function(e){if(0===e)return"0 B";var t=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],a=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,a)).toPrecision(3)+" "+t[a]}}}},1013:function(e,t){},1014:function(e,t){},1015:function(e,t,a){a(1013),a(1014);var s=a(66)(a(1012),a(1016),"data-v-483de72e",null);s.options.__file="F:\\changhaochen\\GitHub\\shifuhui\\src\\views\\my_components\\upload\\noUpFileInput.vue",s.esModule&&Object.keys(s.esModule).some(function(e){return"default"!==e&&"__esModule"!==e})&&console.error("named exports are not supported in *.vue files."),s.options.functional&&console.error("[vue-loader] noUpFileInput.vue: functional components are not supported with templates, they should use render functions."),e.exports=s.exports},1016:function(e,t,a){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"noUpFileInput"},[e.FilePath&&"image"==e.fileInfro.type?a("div",{staticClass:"noUpFileInput-filebox"},[a("img",{staticClass:"re-noUpFileInput-images",attrs:{src:e.FilePath,width:"auto",height:"58"},on:{click:function(t){e.handleView()}}})]):e._e(),e._v(" "),a("input",{ref:"fileObj",staticClass:"noup-file-Input",attrs:{type:"file"},on:{change:function(t){e.handleGetFile()}}}),e._v(" "),e.imgName?a("span",{staticClass:"noUpFileInput-newfile-name"},[e._v(e._s(e.imgName))]):e._e(),e._v(" "),a("Button",{attrs:{type:"ghost",icon:"ios-cloud-upload-outline"},on:{click:e.selectFile}},[e._v(e._s(e.file_infro.uploadMenu))]),e._v(" "),a("Modal",{attrs:{title:"图片预览","cancel-text":"关闭"},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[e.visible?a("img",{staticStyle:{width:"100%"},attrs:{src:e.FilePath}}):e._e()])],1)},staticRenderFns:[]},e.exports.render._withStripped=!0},1083:function(e,t,a){"use strict";(function(e){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(155),i=s(r),o=a(231),n=s(o),d=a(116),l=s(d),u=a(1015),c=s(u),p=a(100),h=s(p);t.default={name:"admin_assignments",components:{noUpFileInput:c.default},data:function(){var t=this,a=function(e,t,a){t>0?a():a(new Error("请选择部门"))},s=function(e,t,a){/^1[0-9]{10}$/.test(t)?a():a(new Error("请输入正确格式的手机号"))},r=function(e,a,s){a!==t.editPasswordForm.newPass?s(new Error("两次输入密码不一致")):s()},i=function(e,t,a){t.file?a():a(new Error("请上传头像"))};return{columns:[{title:"ID",key:"id"},{title:"帐号",key:"account"},{title:"姓名",key:"name"},{title:"手机",key:"mobile"},{title:"创建时间",align:"center",key:"date_added"},{title:"部门",key:"user_group_id",align:"center",render:function(a,s){var r="交易中";return e.each(t.groupData,function(e,t){s.row.user_group_id==t.id&&(r=t.name)}),a("span",{},r)}},{title:"操作",key:"action",width:130,align:"center",render:function(e,a){var s=e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){t.doWhat("edit",a.index)}}},"修改"),r=e("Button",{props:{type:"error",size:"small"},on:{click:function(){t.doWhat("delete",a.index)}}},"删除"),i=[];return t.checkPower("edit")&&i.push(s),t.checkPower("delete")&&i.push(r),e("div",i)}}],saveType:"new",doType:"list",switching:!1,tableData:[],groupData:[],page:{dataCount:0,pageCount:0,pageSize:10,pageNumber:1,pageSizeOpts:[10,20,50,100]},dataReady:0,currentData:{},defaultData:{account:"",name:"",salt:"",mobile:"",face:{url:"",file:"",fileObjName:"用户头像",uploadMenu:"选择图片",uploadType:"sync",type:"image",maxSize:2048},password:"",user_group_id:""},addDataValidate:{account:[{required:!0,message:"请输入帐号",trigger:"blur"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"}],mobile:[{required:!0,message:"请输入手机号码"},{validator:s}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"请至少输入6个字符",trigger:"blur"},{max:32,message:"最多输入32个字符",trigger:"blur"}],face:[{required:!0,validator:i,trigger:"blur"}],user_group_id:[{required:!0,validator:a,trigger:"blur"}]},editDataValidate:{account:[{required:!0,message:"请输入帐号",trigger:"blur"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"}],mobile:[{required:!0,message:"请输入手机号码"},{validator:s}],user_group_id:[{required:!0,validator:a,trigger:"blur"}]},editPasswordForm:{userid:"",oldPass:"",newPass:"",rePass:""},passwordValidate:{oldPass:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPass:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"请至少输入6个字符",trigger:"blur"},{max:32,message:"最多输入32个字符",trigger:"blur"}],rePass:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:r,trigger:"blur"}]},oldPassError:"",editPasswordModal:!1,savePassLoading:!1,searchData:{keyword:"",searchDate:[],startDate:"",endDate:""},searchValidata:{}}},computed:{getLoading:function(){return!(0==this.dataReady)},doName:function(){return"list"==this.doType?"后台管理账户":"edit"==this.doType?"编辑账户":"添加账户"},currentDataValidate:function(){return"add"==this.doType?this.addDataValidate:this.editDataValidate},hasDataChange:function(){return!((0,i.default)(this.currentData)==(0,i.default)(this.tableData[this.currentData.listIndex]))}},methods:{checkPower:function(e){return!!this.$store.state.Rights[n.default.api.system.admin_assignments[e].MD5()]},doWhat:function(e,t){if(!this.checkPower(e))return void this.$Message.warning("对不起，您没有此操作权限！");this.switching=!0,"add"==e&&(this.resetCurrentData(),this.doType="add"),"edit"==e&&(this.showEdit(t),this.doType="edit"),"delete"==e&&this.delete(t),"list"==e&&(this.resetCurrentData(),this.dataReady+=2,this.init(),this.doType="list"),this.switching=!1},showEdit:function(t){this.currentData=e.extend(!0,{},this.tableData[t]),this.doType="edit"},resetCurrentData:function(){this.currentData=e.extend(!0,{},this.defaultData)},changePage:function(e){this.page.pageNumber=e,this.search(e)},changePageSize:function(e){this.page.pageSize=e,this.page.pageCount=Math.ceil(this.page.dataCount/this.page.pageSize),this.search()},resetSearch:function(){this.searchData={keyword:"",searchDate:[],startDate:"",endDate:""},this.page.pageNumber=1,this.dataReady+=1,this.init()},search:function(e){this.searchData.searchDate.length&&(this.searchData.startDate=l.default.FormatDate(this.searchData.searchDate[0],"yyyy-MM-dd"),this.searchData.endDate=l.default.FormatDate(this.searchData.searchDate[1],"yyyy-MM-dd")),this.page.pageNumber=1,e&&(this.page.pageNumber=e),this.doWhat("list")},init:function(){this.getGroups(),this.getList()},getList:function(){var t=this,a={ssid:h.default.get("ssid"),page:this.page.pageNumber,pageSize:this.page.pageSize};""!=this.searchData.keyword&&(a.user_name=this.searchData.keyword),e.ajax({url:n.default.apiRootPath+n.default.api.system.admin_assignments.list,type:"POST",dataType:"json",data:a}).done(function(e){if(t.dataReady--,e)if(0==e.code){t.page.dataCount=e.data.count,t.page.pageCount=Math.ceil(t.page.dataCount/t.page.pageSize);var a=[];e.data.list.forEach(function(e){a.push({id:e.id,account:e.username,name:e.name,salt:e.salt,mobile:e.mobile,face:{url:e.image,file:"",fileObjName:"用户头像",uploadMenu:"选择图片",uploadType:"sync",type:"image",maxSize:2048},password:"",user_group_id:e.user_group_id,date_added:e.date_added,listIndex:a.length})}),t.tableData=a}else n.default.showError({vm:t,data:e,errorMsg:""});else n.default.showError({vm:t,data:e,errorMsg:"请求失败"})}).fail(function(e,a,s){t.dataReady--,n.default.showError({vm:t,errorMsg:"服务器通讯失败"})})},getGroups:function(){var t=this,a={ssid:h.default.get("ssid")};e.ajax({url:n.default.apiRootPath+n.default.api.system.admin_department.list,type:"POST",dataType:"json",data:a}).done(function(e){t.dataReady--,e?0==e.code?t.groupData=e.data.list:n.default.showError({vm:t,data:e,errorMsg:""}):n.default.showError({vm:t,data:e,errorMsg:"请求失败"})}).fail(function(e,a,s){t.dataReady--,n.default.showError({vm:t,errorMsg:"服务器通讯失败"})})},saveEdit:function(){var t=this;this.hasDataChange&&this.$refs.currentData.validate(function(a){if(a){t.switching=!0;var s=new FormData;s.append("ssid",h.default.get("ssid")),s.append("user_group_id",t.currentData.user_group_id),s.append("username",t.currentData.account),s.append("name",t.currentData.name),s.append("password",t.currentData.password),s.append("mobile",t.currentData.mobile),s.append("salt",t.currentData.salt||parseInt(1e6*Math.random())),t.currentData.face.file&&s.append("image",t.currentData.face.file);var r=n.default.apiRootPath+n.default.api.system.admin_assignments.add;"edit"==t.doType&&(s.append("id",t.currentData.id),r=n.default.apiRootPath+n.default.api.system.admin_assignments.edit);e.ajax({url:r,type:"POST",dataType:"json",data:s,cache:!1,contentType:!1,processData:!1}).done(function(e){t.switching=!1,e?0==e.code?(t.currentData.face.file="","add"==t.doType&&t.doWhat("list"),t.$Message.success("账户保存成功！")):n.default.showError({vm:t,data:e,errorMsg:""}):n.default.showError({vm:t,data:e,errorMsg:"请求失败"})}).fail(function(e,a,s){t.switching=!1,n.default.showError({vm:t,data:data,errorMsg:"服务器通讯失败"})})}})},showEditPassword:function(e){e&&(this.editPasswordForm.userid=e,this.editPasswordModal=!0)},cancelEditPass:function(){this.editPasswordForm.userid="",this.editPasswordForm.oldPass="",this.editPasswordForm.newPass="",this.editPasswordForm.rePass="",this.editPasswordModal=!1},saveEditPass:function(){var t=this;this.$refs.editPasswordForm.validate(function(a){if(a){t.savePassLoading=!0;var s={ssid:h.default.get("ssid"),id:t.editPasswordForm.userid,password:t.editPasswordForm.oldPass,new_password:t.editPasswordForm.newPass,ok_new_password:t.editPasswordForm.rePass};e.ajax({url:n.default.apiRootPath+n.default.api.system.admin_assignments.modifyPassword,type:"POST",dataType:"json",data:s}).done(function(e){t.savePassLoading=!1,e?0==e.code?(t.$Message.success("修改密码成功！"),t.editPasswordForm.oldPass="",t.editPasswordForm.newPass="",t.editPasswordForm.rePass="",t.editPasswordForm.userid="",t.editPasswordModal=!1):n.default.showError({vm:t,data:e,errorMsg:""}):n.default.showError({vm:t,data:e,errorMsg:"请求失败"})}).fail(function(e,a,s){t.savePassLoading=!1,n.default.showError({vm:t,data:data,errorMsg:"服务器通讯失败"})})}})},delete:function(t){var a=this;if(this.tableData[t].id){e.ajax({url:n.default.apiRootPath+n.default.api.system.admin_assignments.delete,type:"POST",dataType:"json",data:function(){return{ssid:h.default.get("ssid"),id:a.tableData[t].id,status:0}}()}).done(function(e){e?0==e.code?(a.$Message.success("删除成功!"),a.tableData.splice(t,1)):n.default.showError({vm:a,data:e,errorMsg:""}):n.default.showError({vm:a,data:e,errorMsg:"请求失败"})}).fail(function(e,t,s){n.default.showError({vm:a,errorMsg:"服务器通讯失败"})})}}},mounted:function(){},activated:function(){this.doWhat("list")}}}).call(t,a(154))},1161:function(e,t){},1283:function(e,t,a){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Card",[a("p",{staticClass:"hasButtonP",attrs:{slot:"title"},slot:"title"},[a("Icon",{attrs:{type:"person"}}),e._v("\n            "+e._s(e.doName)+"\n            "),e.checkPower("list")&&"list"!=e.doType?a("Button",{staticClass:"add-btu margin-left-10",attrs:{type:"warning",size:"small"},on:{click:function(t){e.doWhat("list")}}},[e._v("返回列表\n            ")]):e._e(),e._v(" "),e.checkPower("add")&&"list"==e.doType?a("Button",{staticClass:"add-btu",attrs:{type:"primary",size:"small"},on:{click:function(t){e.doWhat("add")}}},[e._v("添加账户\n            ")]):e._e()],1),e._v(" "),a("div",{staticClass:"doBox"},[e.switching?a("Spin",{attrs:{size:"large",fix:""}}):e._e(),e._v(" "),"list"!=e.doType?a("div",[a("Form",{ref:"currentData",attrs:{model:e.currentData,"label-width":100,"label-position":"right",rules:e.currentDataValidate}},[a("FormItem",{attrs:{label:"用户帐号：",prop:"account"}},[a("div",{staticStyle:{display:"inline-block",width:"204px"}},[a("Input",{model:{value:e.currentData.account,callback:function(t){e.$set(e.currentData,"account",t)},expression:"currentData.account"}})],1)]),e._v(" "),a("FormItem",{attrs:{label:"用户姓名：",prop:"name"}},[a("div",{staticStyle:{display:"inline-block",width:"204px"}},[a("Input",{model:{value:e.currentData.name,callback:function(t){e.$set(e.currentData,"name",t)},expression:"currentData.name"}})],1)]),e._v(" "),a("FormItem",{attrs:{label:"用户手机：",prop:"mobile"}},[a("div",{staticStyle:{display:"inline-block",width:"204px"}},[a("Input",{model:{value:e.currentData.mobile,callback:function(t){e.$set(e.currentData,"mobile",t)},expression:"currentData.mobile"}})],1)]),e._v(" "),a("FormItem",{attrs:{label:"头像：",prop:"face"}},[a("noUpFileInput",{attrs:{fileInfro:e.currentData.face}})],1),e._v(" "),a("FormItem",{attrs:{label:"部门：",prop:"user_group_id"}},[a("div",{staticStyle:{width:"204px"}},[a("Select",{attrs:{placeholder:"请选择部门"},model:{value:e.currentData.user_group_id,callback:function(t){e.$set(e.currentData,"user_group_id",t)},expression:"currentData.user_group_id"}},e._l(e.groupData,function(t,s){return t?a("Option",{key:t.id,attrs:{label:t.name,value:t.id}},[a("label",{staticClass:"bank-card-username"},[e._v(e._s(t.name))])]):e._e()}))],1)]),e._v(" "),e.checkPower("modifyPassword")&&"edit"==e.doType||"add"==e.doType?a("FormItem",{attrs:{label:"登录密码：",prop:"password"}},["add"==e.doType?a("div",{staticStyle:{display:"inline-block",width:"204px"}},[a("Input",{model:{value:e.currentData.password,callback:function(t){e.$set(e.currentData,"password",t)},expression:"currentData.password"}})],1):e._e(),e._v(" "),e.checkPower("modifyPassword")&&"edit"==e.doType?a("Button",{attrs:{size:"small"},on:{click:function(t){e.showEditPassword(e.currentData.id)}}},[e._v("点击修改密码")]):e._e()],1):e._e(),e._v(" "),a("div",[a("Button",{staticStyle:{width:"100px"},attrs:{type:"text"},on:{click:function(t){e.doWhat("list")}}},[e._v("取消")]),e._v(" "),a("Button",{staticStyle:{width:"100px"},attrs:{type:"primary"},on:{click:e.saveEdit}},[e._v("保存")])],1)],1)],1):e._e(),e._v(" "),"list"==e.doType?a("div",{staticClass:"ordler-list"},[a("div",{staticClass:"search-box"},[a("Form",{ref:"searchData",attrs:{model:e.searchData,rules:e.searchValidata,inline:""}},[a("FormItem",{attrs:{prop:"keyword"}},[a("Input",{attrs:{type:"text",placeholder:"输入名称搜索帐号"},model:{value:e.searchData.keyword,callback:function(t){e.$set(e.searchData,"keyword",t)},expression:"searchData.keyword"}},[a("Icon",{attrs:{slot:"prepend",type:"ios-eye"},slot:"prepend"})],1)],1),e._v(" "),a("FormItem",[a("Button",{attrs:{type:"primary",icon:"search"},on:{click:function(t){e.search()}}},[e._v("搜索")])],1)],1)],1),e._v(" "),a("Table",{attrs:{border:"",columns:e.columns,loading:e.getLoading,data:e.tableData}}),e._v(" "),a("div",{staticClass:"page-box"},[e.page.pageCount>1?a("Page",{attrs:{total:e.page.dataCount,current:e.page.pageNumber,"show-total":"","page-size-opts":e.page.pageSizeOpts,"page-size":e.page.pageSize,"show-elevator":"",placement:"top","show-sizer":""},on:{"on-change":e.changePage,"on-page-size-change":e.changePageSize}}):e._e()],1)],1):e._e()],1),e._v(" "),a("Modal",{attrs:{closable:!1,"mask-closable":!1,width:500},model:{value:e.editPasswordModal,callback:function(t){e.editPasswordModal=t},expression:"editPasswordModal"}},[a("h3",{staticStyle:{color:"#2D8CF0"},attrs:{slot:"header"},slot:"header"},[e._v("修改密码")]),e._v(" "),a("Form",{ref:"editPasswordForm",attrs:{model:e.editPasswordForm,"label-width":100,"label-position":"right",rules:e.passwordValidate}},[a("input",{staticStyle:{display:"none"},attrs:{type:"password",name:"notAutoComplete"}}),e._v(" "),a("FormItem",{attrs:{label:"原密码",prop:"oldPass",error:e.oldPassError}},[a("Input",{attrs:{type:"password",placeholder:"请输入现在使用的密码"},model:{value:e.editPasswordForm.oldPass,callback:function(t){e.$set(e.editPasswordForm,"oldPass",t)},expression:"editPasswordForm.oldPass"}})],1),e._v(" "),a("FormItem",{attrs:{label:"新密码",prop:"newPass"}},[a("Input",{attrs:{placeholder:"请输入新密码，至少6位字符"},model:{value:e.editPasswordForm.newPass,callback:function(t){e.$set(e.editPasswordForm,"newPass",t)},expression:"editPasswordForm.newPass"}})],1),e._v(" "),a("FormItem",{attrs:{label:"确认新密码",prop:"rePass"}},[a("Input",{attrs:{placeholder:"请再次输入新密码"},model:{value:e.editPasswordForm.rePass,callback:function(t){e.$set(e.editPasswordForm,"rePass",t)},expression:"editPasswordForm.rePass"}})],1)],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"text"},on:{click:e.cancelEditPass}},[e._v("取消")]),e._v(" "),a("Button",{attrs:{type:"primary",loading:e.savePassLoading},on:{click:e.saveEditPass}},[e._v("保存")])],1)],1)],1)],1)},staticRenderFns:[]},e.exports.render._withStripped=!0}});